import numpy as np
import matplotlib.pyplot as plt
import time

def gbm(S0, mu, sigma, T, N):
    """
    Generate a Geometric Brownian Motion process.
    
    Parameters:
    S0 (float): initial stock price
    mu (float): expected return
    sigma (float): standard deviation of returns
    T (float): total time
    N (int): number of discrete time steps in the simulation
    
    Returns:
    np.array: simulated geometric Brownian motion process of one walk between time 0 and time 1.
    """
    dt = T / N
    t = np.linspace(0, T, N)
    W = np.random.standard_normal(size=N)
    W = np.cumsum(W) * np.sqrt(dt)
    X = (mu - 0.5 * sigma**2) * t + sigma * W
    S = S0 * np.exp(X)
    return S

# Set initial stock price, expected return, volatility, time, and number of steps
S0 = 100 # Initial stock price
mu = 0.1 # Expected value
sigma = 0.2 #standard deviation of returns
T = 1 # Total time of simulation
N = 252 # Number of discrete time-steps in the simulation

# Simulate the GBM process
ammount_simulations = int(input("Enter how many simulation you want to run: "))

for _ in range(1, ammount_simulations):
    current_GBM = gbm(S0, mu, sigma, T, N)
    plt.plot(current_GBM)
    

#plt.plot(A) ghjgjgv
plt.xlabel("Time")
plt.ylabel("Stock Price")
plt.title("Geometric Brownian Motion Simulation(s)")
plt.show()


# Calculate the average of all simulations
average = np.mean(np.array([gbm(S0, mu, sigma, T, N) for _ in range(ammount_simulations)]), axis=0)
# Plot the average of all simulations
plt.plot(average, label='Average')
plt.legend()
plt.xlabel("Time")
plt.ylabel("Stock Price")
plt.title("Average of Geometric Brownian Motion Simulations. (For the ammount of simulations you chose.)")
plt.show()

simulation_numbers = [5, 10, 50, 100, 500, 1000]
for ammount_simulations in simulation_numbers:
    # Calculate the average of all simulations
    average = np.mean(np.array([gbm(S0, mu, sigma, T, N) for _ in range(ammount_simulations)]), axis=0)
    
    # Plot the average of all simulations
    plt.plot(average, label=f'Average of {ammount_simulations} simulations.')
    plt.legend()
    plt.xlabel("Time")
    plt.ylabel("Stock Price")
    plt.title("Average of Geometric Brownian Motion Simulations, close this window for next one.")
    plt.show()
    #time.sleep(1)



def BS_call_price(S, K, r, sigma, T):
    d1 = (np.log(S / K) + (r + 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))
    d2 = (np.log(S / K) + (r - 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))
    call_price = (S * norm.cdf(d1) - K * np.exp(-r * T) * norm.cdf(d2))
    return call_price

# Set the strike price, risk-free rate, volatility, and time to expiration
K = 100 # Strike price
r = 0.05 # Risk-free rate
sigma = 0.2 # Volatility
T = 1 # Time to expiration

# Calculate the BS option price
bs_price = BS_call_price(S0, K, r, sigma, T)
print("BS option price: ", bs_price)
